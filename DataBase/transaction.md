# 트랜잭션 Transaction

- 데이터베이스의 상태를 바꾸기 위해 수행하는 작업의 단위 또는 일련의 연산

## 특징 : ACID

- 원자성 Atomicity : 트랜잭션이 데이터베이스에 완전히 반영되거나 아예 실행되지 않아야 함
- 일관성 Consistency : 트랜잭션 수행이 완료된 DB는 일관성을 가짐
- 독립성 Isolation : 수행 중인 트랜잭션에는 다른 트랜잭션이 끼어들 수 없음
- 영속성 Durability : 완료한 트랜잭션의 결과가 DB에 영구적 반영

## 명령어 : TCL ; Transaction Control Language

- COMMIT : 트랜잭션이 정상적으로 종료되어 데이터베이스에 변경 사항을 반영하는 명령어
- ROLLBACK : 트랜잭션이 비정상적으로 종료되어 트랜잭션이 수행한 변경 사항을 취소하고 DB를 이전 상태로 되돌리는 명령어
- SAVEPOINT : 트랜잭션에서 특정 지점을 지정하는 명령어
	- ROLLBACK과 함께 사용 시 해당 지점으로 되돌릴 수 있음

## 트랜잭션 상태전이도

![](https://itwiki.kr/images/1/1e/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98_%EC%83%81%ED%83%9C%EC%A0%84%EC%9D%B4%EB%8F%84.png)

- 활성 (활성화) : 트랜잭션이 시작되어 처리 중인 상태
- 부분 완료 (부분적 완료) : 트랜잭션의 모든 연산이 처리가 완료되었으나 DB에 수행 결과가 반영되지 않은 상태
- 완료 : 트랜잭션 연산 처리가 완료되고 DB에 결과가 반영된 상태
- 실패 : 트랜잭션 처리 중 오류가 발생해 트랜잭션이 중단된 상태
- 철회 : 트랜잭션이 중단되어 ROLLBACK 수행으로 DB를 이전으로 되돌린 상태

### 트랜잭션 격리

- 트랜잭션 격리 수준 Transaction isolation level : 여러 트랜잭션이 서로 영향을 미치지 않고 실행될 수 있는 단계

![](https://velog.velcdn.com/images/chb1828/post/1b0e0e8a-b517-4310-b5b2-bd7afb6ffda6/image.png)

- Read-Uncommited
	- 트랜잭션의 Commit 여부와 상관 없이 타 트랜잭션의 데이터 조회 가능
	- 한 번에 여러 트랜잭션 처리 가능 -> 높은 동시성
	- 데이터 일관성 유지 어려움
- Read-Committed
	- 트랜잭션이 Commit된 데이터만 타 트랜잭션에서 조회 가능
- Repeatable-Read
	- 트랜잭션이 읽은 데이터를 타 트랜잭션에서 갱신 및 삭제 불가능
- Serializable
	- 트랜잭션이 읽은 데이터를 타 트랜잭션에서 갱신, 삭제 및 삽입 불가

- 동시성이 높을 경우
	- 트랜잭션 동시 처리
	- 일관성 문제 발생 확률 상승
- 고립성이 높을 경우
	- 트랜잭션 처리 중 타 트랜잭션 접근 제한 -> 효율 하락

# 락 Lock

- 트랜잭션 처리 순서 보장을 위한 방법
- 상호배제 기법과 유사

## 락의 종류

### 공유 락 Shared lock

- 읽기 락 read lock 이라고도 함
- 데이터를 읽는 락
- 데이터 일관성에 영향을 주지 않음 -> 데이터에 여러 공유 락이 동시 접근 가능

### 배타 락 exclusive lock

- 데이터를 수정하는 락
- 쓰기 락 write lock 이라고도 함
- 데이터 일관성 유지를 위해 데이터에는 한 번에 하나의 베타 락만이 접근 가능




## 교착 상태 deadlock

- 트랜잭션 역시 프로세스처럼 교착 상태에 빠질 수 있음
- 특정 데이터의 락을 가진 트랜잭션이 타 데이터의 락을 추가 요청하며 발생 -> **무한 대기 상태에 빠진 현상**
### 1. 예방 기법
- 트랜잭션 처리 시작 전에 필요한 데이터에 대해 미리 락을 얻는 방식
- 미리 락을 얻으므로 불필요한 낭비 발생

### 2. 회피 기법
- 트랜잭션 순서에 따라 교착 상태를 회피하는 방식
- wait-die
	- 데이터의 락을 요청하려는 트랜잭션이 해당 데이터에 대해 이미 락을 가진 트랜잭션보다 오래되었을 경우 락 획득 시까지 대기
	- 락을 가진 트랜잭션보다 최신일 경우 락 획득 포기
- wound-wait
	- 데이터의 락을 요청하려는 트랜잭션이 해당 데이터에 대해 이미 락을 가진 트랜잭션보다 오래되었을 경우 락을 뺏음
	- 락을 가진 트랜잭션보다 최신일 경우 락 획득 대기


# 이상과 정규화 Anomaly & Normalization

## 이상 anomaly

- 트랜잭션 처리 중 속성 간 종속 또는 데이터 중복으로 발생하는 문제

### 삽입 이상 insertion anomaly

- 데이터 삽입 시 의도치 않은 타 데이터의 동반 삽입

### 갱신 이상 update anomaly

- 데이터 갱신 시 일부 튜플만 갱신되어 데이터 모순 발생

### 삭제 이상 deletion anomaly

- 데이터 삭제 시 의도하지 않은 데이터도 삭제

## 정규화 normalization

- 데이터베이스의 이상 현상을 해결하기 위해 테이블을 분해하는 것
- 테이블 분해로 인해 연산 시간 증가 -> 상황에 따라 적절한 정규화 진행이 필요

### 정규형 normal form

- 정규화의 결과
- 제 1 정규형 1NF
	- 테이블의 모든 속성 값이 더이상 분해될 수 없는 값 = 원자 값으로 구성되어야 함
- 제 2 정규형 2NF
	- 제1정규형에 속하는 테이블에서 부분적 함수 종속 제거 -> 완전 함수 종속 만족
	- ** 함수 종속성
		- 테이블에서 속성 간 종속 관계를 의미
		- A 속성이 B 속성 결정 시 : B 속성은 A 속성에 함수 종속된 관계
			- A : 결정자
			- B : 종속자
	- ** 완전 함수 종속
		- A 속성이 B 속성을 결정하나 A 속성의 진부분집합이 B 속성을 결정하지 않는 경우
	- ** 부분적 함수 종속
		- 기본 키의 부분집합이 결정자가 될 수 있음을 의미
- 제 3 정규형 3NF
	- 제2정규형에 속하는 테이블에서 이행적 종속 제거
	- ** 이행적 종속
		- A가 B를, B가 C를 결정할 때 A가 C를 결정하는 것
		- A -> B와 B -> C로 분리 필요
- 보이스-코드 정규형 BCNF ; Boyce-Codd Normal Form
	- 강한 제3정규형이라고도 함
	- 제3정규형에 속하는 테이블의 모든 결정자가 후보 키가 되도록 테이블 분해가 필요
- 제 4 정규형 4NF
	- BCNF에 속하는 테이블에서 다치 종속을 제거
	- ** 다치 종속
		- 테이블에서 한 속성이 여러 속성의 값을 결정하는 것을 의미
- 제 5 정규형 5NF
	- 제4정규형에 속하는 테이블에서 조인 종속 제거
	- ** 조인 종속
		- 테이블 분해 이후 재조인 시 테이블이 복원될 경우 "조인 종속이 없다" 표현

### 역정규화 Denormalization

- 정규화된 테이블을 낮은 정규화 단계의 테이블로 되돌리는 것
- 읽기 성능 향상 시 사용